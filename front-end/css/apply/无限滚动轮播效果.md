# 无限滚动轮播效果

> 原文[Amazing Pure CSS Marquee Effect](https://github.com/chokcoco/iCSS/issues/184)

巧用逐帧动画，配合补间动画实现一个无限循环的轮播效果，像是这样：

![img1](https://user-images.githubusercontent.com/8554143/169294742-34a2bb8f-9129-4a7b-a11b-8d60fe6b1d26.gif)

看到上述示意图，这不是个非常简单的位移动画么？

来简单分析分析，从表面上看，确实好像只有元素的 transform: translate() 在位移，但是注意，这里有两个难点：

1. 这是个无限轮播的效果，我们的动画需要支持任意多个元素的无限轮播切换
2. 因为是轮播，所以，运行到最后一个的时候，需要动画切到第一个元素

到这里，可以暂停思考一下，如果有 20 个元素，需要进行类似的无限轮播播报，使用 CSS 实现，怎么去做呢？

## 逐帧动画控制整体切换

首先，需要利用到逐帧动画效果，也被称为步骤缓动函数，利用的是 animation-timing-function 中的 steps。

以开头的例子，假设存在这样 HTML 结构：

```html
<div class="g-container">
  <ul>
    <li>Lorem ipsum 1111111</li>
    <li>Lorem ipsum 2222222</li>
    <li>Lorem ipsum 3333333</li>
    <li>Lorem ipsum 4444444</li>
    <li>Lorem ipsum 5555555</li>
    <li>Lorem ipsum 6666666</li>
  </ul>
</div>
```

实现这样一个简单的布局：

![img2](https://user-images.githubusercontent.com/8554143/169681177-3bcc9a3e-f32f-4892-9156-8ab38d515db9.png)

要实现轮播效果，并且是任意个数，可以借助 animation-timing-function: steps()：

```css
:root {
  /* 轮播的个数 */
  --s: 6;
  /* 单个 li 容器的高度 */
  --h: 36;
  /* 单次动画的时长 */
  --speed: 1.5s;
}
.g-container {
  width: 300px;
  height: calc(var(--h) * 1px);
}
ul {
  display: flex;
  flex-direction: column;
  animation: move calc(var(--speed) * var(--s)) steps(var(--s)) infinite;
}
ul li {
  width: 100%;
}
@keyframes move {
  0% {
    transform: translate(0, 0);
  }
  100% {
    transform: translate(0, calc(var(--s) * var(--h) * -1px));
  }
}
```

别看到上述有几个 CSS 变量就慌了，其实很好理解：

- `calc(var(--speed) * var(--s))`：单次动画的耗时 乘以 轮播的个数，也就是总动画时长
- `steps(var(--s))` 就是逐帧动画的帧数，这里也就是 steps(6)，很好理解
- `calc(var(--s) * var(--h) * -1px))` 单个 li 容器的高度 乘以 轮播的个数，其实就是 ul 的总体高度，用于设置逐帧动画的终点值

上述的效果，实际如下：

![img3](https://user-images.githubusercontent.com/8554143/169681483-f4ccced1-0d2e-475e-af60-2ca54e9402f5.gif)

如果给容器添加上 overflow: hidden，就是这样的效果：

![img4](https://user-images.githubusercontent.com/8554143/169681559-3aae3e2c-6f7e-4eac-84cc-f014d74a05c9.gif)

这样，我们就得到了整体的结构，至少，整个效果是循环的。

但是由于只是逐帧动画，所以只能看到切换，但是每一帧之间，没有过渡动画效果。所以，接下来，我们还得引入补间动画。

## 利用补间动画实现两组数据间的切换
