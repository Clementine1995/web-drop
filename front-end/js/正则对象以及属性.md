# 正则对象以及属性

>参考[正则表达式](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions)
>
>参考[RegExp](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp)
>
>参考[Assertions](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions/Assertions)
>
>参考[关于正则位置匹配（断言）的技巧](https://juejin.im/post/6844903646346346503)
>
>参考[正则表达式不要背](https://juejin.im/post/6844903845227659271)
>
>参考[JavaScript:正则表达式的/y标识](https://www.cnblogs.com/ziyunfei/archive/2012/12/07/2807313.html)

## 正则对象

正则对象用于将文本与一个模式匹配。

### 如何创建一个正则对象

1. 字面量形式：由斜杠`/`包围。
2. 构造函数：`new RegExp()`创建。

例如下面这三种都会创建相同效果的正则对象

```js
/ab+c/i;
new RegExp('ab+c', 'i');
new RegExp(/ab+c/, 'i');
```

区别就是：当表达式被赋值时，字面量形式提供正则表达式的编译状态，而正则表达式对象的构造函数，如 new RegExp('ab+c') 提供了正则表达式运行时编译

#### RegExp() 构造函数

语法：

```js
new RegExp(pattern[, flags])
RegExp(pattern[, flags])
```

第一个参数 pattern 可以是字符串也可以是正则对象，第二个参数 flag 就是标志，如果第一个参数是正则对象，那么 flag 会替换掉之前的，如果第二个参数不传，那么之前的标志还会保留，可选的 flag 在下面标志搜索部分

## 正则对象的属性

+ lastIndex
+ flags
+ dotAll
+ global
+ ignoreCase
+ multiline
+ source
+ sticky
+ unicode

### lastIndex

lastIndex 是正则表达式的一个可读可写的整型属性，用来指定下一次匹配的起始索引。

只有正则表达式使用了表示全局检索的 "g" 或者 "y" 标志时，该属性才会起作用。更改的规则如下：

+ 如果 lastIndex 大于字符串的长度，则 regexp.test 和 regexp.exec 将会匹配失败，然后 lastIndex 被设置为 0。
+ 如果 lastIndex 等于字符串的长度，且该正则表达式**匹配**空字符串，则该正则表达式匹配从 lastIndex 开始的字符串。
+ 如果 lastIndex 等于字符串的长度，且该正则表达式**不匹配**空字符串，则该正则表达式不匹配字符串，lastIndex 被设置为 0。
+ 否则，lastIndex 被设置为紧随最近一次成功匹配的下一个位置。

## 正则对象的方法

### exec()

exec() 方法在一个指定字符串中执行一个搜索匹配。返回一个结果数组或 null。

在设置了 `global` 或 `sticky` 标志位的情况下（如 /foo/g or /foo/y），JavaScript RegExp 对象是有状态的。他们会将上次成功匹配后的位置记录在 `lastIndex` 属性中。使用此特性，`exec()` 可用来对单个字符串中的多次匹配结果进行逐条的遍历（包括捕获到的匹配），而相比之下，`String.prototype.match()` 只会返回匹配到的结果。

如果匹配成功，exec() 方法返回一个数组，并更新正则表达式对象的 lastIndex 属性。完全匹配成功的文本将作为返回数组的第一项，从第二项起，后续每项都对应正则表达式内捕获括号里匹配成功的文本。

如果匹配失败，exec() 方法返回 null，并将 lastIndex 重置为 0 。

下面的例子展示了返回数组的属性

```js
// Match "quick brown" followed by "jumps", ignoring characters in between
// Remember "brown" and "jumps"
// Ignore case
var re = /quick\s(brown).+?(jumps)/ig;
var result = re.exec('The Quick Brown Fox Jumps Over The Lazy Dog');
```

|对象|属性/索引|描述|例子|
|-|----|-|-|
|result|[0]|匹配的全部字符串|Quick Brown Fox Jumps|
||[1], ...[n ]|括号中的分组捕获|[1] = Brown [2] = Jumps|
||index|匹配到的字符位于原始字符串的基于0的索引值|4|
||input|原始字符串|The Quick Brown Fox Jumps Over The Lazy Dog|

### test()

test() 方法执行一个检索，用来查看正则表达式与指定的字符串是否匹配。返回 true 或 false。当想要知道一个模式是否存在于一个字符串中时，就可以使用 test()（类似于 String.prototype.search() 方法），差别在于test返回一个布尔值，而 search 返回索引（如果找到）或者-1（如果没找到）

正则表达式设置了全局标志，test() 的执行会改变正则表达式 lastIndex属性。

### 调用 String 对应的方法

`[@@match]()`,`[@@matchAll]()`,`[@@replace]()`,`[@@search]()`,`[@@split]()` 这几个方法内部都是会调用对应 String.prototype 上的方法，只不过是 this 和参数顺序不同，同时 RegExp 的子类也可以覆写这些方法来修改默认行为。

#### match()

match() 方法检索返回一个字符串匹配正则表达式的的结果。

+ 语法：

```js
str.match(regexp)
```

+ 参数：

regexp：一个正则表达式对象。如果传入一个非正则表达式对象，则会隐式地使用 new RegExp(obj) 将其转换为一个 RegExp 。如果你没有给出任何参数并直接使用match() 方法 ，你将会得到一个包含空字符串的 Array ：[""] 。

+ 返回值：

  + 如果使用g标志，则将返回与完整正则表达式匹配的所有结果，但不会返回捕获组。
  + 如果未使用g标志，则仅返回第一个完整匹配及其相关的捕获组（Array）。 在这种情况下，返回的项目将具有如下所述的其他属性。

+ 附加属性

  + groups: 一个捕获组数组 或 undefined（如果没有定义命名捕获组）。
  + index: 匹配的结果的开始位置
  + input: 搜索的字符串.

一个Array，其内容取决于global（g）标志的存在与否，如果未找到匹配则为null。

如果正则表达式不包含 g 标志，str.match() 将返回与 RegExp.exec(). 相同的结果。

#### matchAll

## 标志搜索

|标志|描述|
|-|-|
|g|全局搜索|
|i|不区分大小写搜索|
|m|多行搜索|
|s|允许 . 匹配换行符|
|u|使用unicode码的模式进行匹配|
|y|执行“粘性(sticky)”搜索,匹配从目标字符串的当前位置开始|

注意：m标志用于指定多行输入字符串应该被视为多个行。如果使用m标志，^和$匹配的开始或结束输入字符串中的每一行，而不是整个字符串的开始或结束。

### y 标志与 g 标志

标志 y 会进行粘性(sticky)匹配，它与全局匹配标志 g 一样会让引擎在匹配过程执行完毕后更新**正则对象**的lastIndex属性的值，但是加了y之后，正则表达式就成了一个带隐藏属性（也就是lastIndex）的表达式，必须从lastIndex指定的位置匹配，如果不成功就结束语句。

注意：对于replace和match来讲，lastIndex值始终是0。
