# 资源加载

>参考自[深度解析之异步加载和预加载](https://segmentfault.com/a/1190000018738129?utm_source=tag-newest)，[用 preload 预加载页面资源](https://juejin.im/post/5a7fb09bf265da4e8e785c38)，[[译] 资源提示 —— 什么是 Preload，Prefetch 和 Preconnect？](https://juejin.im/post/5b5984b851882561da216311)，[link标签实现预加载功能详解](https://juejin.im/post/5b2385f1e51d4558b80b10d1)，[通过rel="preload"进行内容预加载
](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Preloading_content)

+ 懒加载（图片）
+ 异步加载
+ 预加载

## 懒加载

懒加载也叫延迟加载，指的是在长网页中延迟加载图像，是一种很好优化网页性能的方式。

### 原理

将页面中的img标签src指向一张小图片或者src为空，然后定义data-src（这个属性可以自定义命名，我才用data-src）属性指向真实的图片。src指向一张默认的图片，否则当src为空时也会向服务器发送一次请求。可以指向loading的地址。注意：图片要指定宽高。

## 异步加载（JS）

默认情况HTML解析，然后加载JS，此时HTML解析中断，然后执行JS，最后JS执行完成恢复HTML解析。下图展示了不同js加载方式下，对html加载的影响。

![异步加载区别](http://upload-images.jianshu.io/upload_images/3828575-e6b0ece566e78abe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

+ 没有 defer 或 async，浏览器会立即加载并执行指定的脚本，“立即”指的是在渲染该 script 标签之下的文档元素之前，也就是说不等待后续载入的文档元素，读到就加载并执行。
+ async 则是乱序执行的，反正对它来说脚本的加载和执行是紧紧挨着的，所以不管你声明的顺序如何，只要它加载完了就会立刻执行，最迟也会在load事件前执行完。不过它对于那些可以不依赖任何脚本或不被任何脚本依赖的脚本来说却是非常合适的。
+ 有 defer，加载后续文档元素的过程将和 js 的加载并行进行（异步），但是 js 的执行要在所有元素解析完成之后，DOMContentLoaded 事件触发之前完成。同时要注意的是defer是按照加载顺序执行脚本的。
+ module情况和defer的情况类似，只不过会在提取的过程中加载多个JS文件罢了

## 预加载

浏览器加载资源的时候，对于每一个资源都有其自身的默认优先级，以谷歌浏览器为例，我们打开控制台，并切换到Network选项，点击刷新页面，在网络下面的title一行点击鼠标右键，勾选Priority即可看到加载资源的优先级。下图展示了不同资源加载的优先级规则。

![不同资源加载的优先级规则](https://user-gold-cdn.xitu.io/2018/2/11/16182c9d3ff9f3c2?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

### Preload

### Prefetch

### dns-prefetch

### Preconnect

### Prerender
